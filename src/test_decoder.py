import pytest

from . import br_decoder


class TestBarcodeStringExtraction():
    "Verify extraction of field values with sample data from previous orders."

    barcode_data = [
        "[)>.06.P4463-D1CPC0306QR050FF-T50CT-ND.1PD1CPC0306QR050FF-T50.K202301100001.1K79514818.10K94852328.11K1.4LCN.Q10.11ZPICK.12Z16735650.13Z924360.20Z000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
        "[)>.06.P160-1350-5-ND.1PLTV-814H.K6666190045.1K59394301.10K67935666.11K1.4LTH.Q4.11ZPICK.12Z385820.13Z194779.20Z0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
        "[)>.06.P36-783-C-ND.1P783-C.K202301100001.1K79514818.10K94852328.11K1.4LUS.Q1.11ZPICK.12Z4499466.13Z924361.20Z000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
        "[)>.06.P3191-S14CT-ND.1PS14.30P3191-S14CT-ND.K202307210001.1K82398896.10K98878108.9D2307.1TBA030123021303300.11K1.4LCN.Q100.11ZPICK.12Z13913090.13Z999999.20Z0000000000000000000000000000000000000000000000000000000000000000000000000000",
        "[)>.06.P1292-WR06X221JTLCT-ND.1PWR06X221 JTL.30P1292-WR06X221JTLCT-ND.K202307210001.1K82398896.10K98878108.9D.1T128977.11K1.4LCN.Q478.11ZPICK.12Z13242498.13Z999999.20Z000000000000000000000000000000000000000000000000000000000000000000",
        "[)>.06.P2648-SC0889-ND.1PSC0889.30P2648-SC0889-ND.K202307210001.1K82398896.10K98878108.9D08/02/2023.1T.11K1.4LGB.Q1.11ZPICK.12Z17877576.13Z999999.20Z000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
    ]

    expected_prefix = ["P", "1P", "Q"]

    expected_fields = [
        ("4463-D1CPC0306QR050FF-T50CT-ND", "D1CPC0306QR050FF-T50", 10),
        ("160-1350-5-ND", "LTV-814H", 4),
        ("36-783-C-ND", "783-C", 1),
        ("3191-S14CT-ND", "S14", 100),
        ("1292-WR06X221JTLCT-ND", "WR06X221 JTL", 478),
        ("2648-SC0889-ND", "SC0889", 1),
    ]

    def test_string_extraction(self):
        "Test for correct extraction of field values."
        decoder = br_decoder.Decoder()

        for idx, data in enumerate(self.barcode_data):
            assert decoder.decode(data) == self.expected_fields[idx]